<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Heroes of Shady Grove</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:,"> <!-- Prevents 404 for favicon -->
  <style>
    body, html {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    #renderCanvas {
      width: 100%;
      height: 100%;
      touch-action: none;
      outline: none;
    }
    #loadingScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      z-index: 1000;
    }
    #loadingBar {
      width: 50%;
      height: 20px;
      margin-top: 20px;
      border: 1px solid #444;
      border-radius: 10px;
      overflow: hidden;
    }
    #loadingBarFill {
      height: 100%;
      width: 0%;
      background: #4CAF50;
      transition: width 0.3s;
    }
  </style>
</head>
<body>
  <div id="loadingScreen">
    <h1>Loading Heroes of Shady Grove</h1>
    <div id="loadingBar">
      <div id="loadingBarFill"></div>
    </div>
    <p id="loadingText">Initializing...</p>
  </div>
  <canvas id="renderCanvas" touch-action="none"></canvas>

  <!-- Load Babylon.js and its dependencies first -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
  <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>

  <!-- Load Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Load game configuration and systems -->
  <script src="hosg_config.js"></script>
  <script src="hosg_asset_loader.js"></script>
  <script src="hosg_game_systems.js"></script>
  <script src="hosg_game_systems_enhanced.js"></script>
  <script src="hosg_advanced_features.js"></script>
  <script src="integration_helpers.js"></script>
  <script src="fixes.js"></script>

  <!-- Game Initialization -->
  <script>
    // Global game state
    window.game = {
      scene: null,
      engine: null,
      canvas: null,
      loading: {
        progress: 0,
        status: 'Initializing...',
        update: function(progress, status) {
          this.progress = progress;
          this.status = status || this.status;
          document.getElementById('loadingBarFill').style.width = `${progress}%`;
          document.getElementById('loadingText').textContent = this.status;
          if (progress >= 100) {
            setTimeout(() => {
              document.getElementById('loadingScreen').style.display = 'none';
            }, 500);
          }
        }
      }
    };

    // Initialize the game when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      try {
        window.game.loading.update(10, 'Setting up game environment...');
        
        // Create the canvas
        const canvas = document.getElementById('renderCanvas');
        window.game.canvas = canvas;
        
        // Initialize the engine
        const engine = new BABYLON.Engine(canvas, true, {
          preserveDrawingBuffer: true,
          stencil: true
        });
        window.game.engine = engine;
        window.game.loading.update(20, 'Engine initialized...');
        
        // Create the scene
        const scene = new BABYLON.Scene(engine);
        window.game.scene = scene;
        window.game.loading.update(30, 'Scene created...');
        
        // Initialize game systems
        if (typeof initGame === 'function') {
          initGame(scene);
          window.game.loading.update(50, 'Game systems initialized...');
        }
        
        // Initialize advanced features if available
        if (typeof initAdvancedFeatures === 'function') {
          initAdvancedFeatures(scene);
          window.game.loading.update(70, 'Loading advanced features...');
        }
        
        // Start the render loop
        engine.runRenderLoop(function() {
          if (scene) {
            scene.render();
          }
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
          engine.resize();
        });
        
        window.game.loading.update(90, 'Finalizing...');
        
        // Complete loading
        setTimeout(() => {
          window.game.loading.update(100, 'Ready!');
          console.log('Game initialized successfully');
        }, 500);
        
      } catch (error) {
        console.error('Error initializing game:', error);
        window.game.loading.update(0, `Error: ${error.message}`);
      }
    });
  </script>
</body>
</html>
