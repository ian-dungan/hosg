<!-- ============================================================
     HEROES OF SHADY GROVE - ENHANCED UI v3.0
     Add this HTML to your index.html (before closing </body> tag)
     ============================================================ -->

<!-- Inventory Panel -->
<div id="inventory-panel" style="display:none;">
  <div class="panel-header">
    <span>Inventory</span>
    <span id="inventory-gold">Gold: 0</span>
    <button id="inventory-close">√ó</button>
  </div>
  <div class="panel-content">
    <div id="equipped-slots">
      <div class="equip-slot" data-slot="weapon">
        <div class="slot-label">Weapon</div>
        <div class="slot-item" id="equipped-weapon">Empty</div>
      </div>
      <div class="equip-slot" data-slot="armor">
        <div class="slot-label">Armor</div>
        <div class="slot-item" id="equipped-armor">Empty</div>
      </div>
      <div class="equip-slot" data-slot="accessory">
        <div class="slot-label">Accessory</div>
        <div class="slot-item" id="equipped-accessory">Empty</div>
      </div>
    </div>
    <div id="inventory-grid"></div>
  </div>
</div>

<!-- Quest Panel -->
<div id="quest-panel" style="display:none;">
  <div class="panel-header">
    <span>Quests</span>
    <button id="quest-close">√ó</button>
  </div>
  <div class="panel-content">
    <div id="active-quests"></div>
    <div id="available-quests"></div>
  </div>
</div>

<!-- Skill Tree Panel -->
<div id="skill-panel" style="display:none;">
  <div class="panel-header">
    <span>Skills</span>
    <span id="skill-points">Points: 0</span>
    <button id="skill-close">√ó</button>
  </div>
  <div class="panel-content">
    <div id="skill-grid"></div>
  </div>
</div>

<!-- Enhanced Minimap -->
<div id="minimap-enhanced">
  <canvas id="minimap-canvas" width="180" height="180"></canvas>
  <div id="minimap-info">
    <div id="zone-name">Starting Zone</div>
    <div id="enemy-count">Enemies: 0</div>
  </div>
</div>

<!-- Quick Access Buttons -->
<div id="quick-menu">
  <button id="btn-inventory" class="quick-btn">üì¶ I</button>
  <button id="btn-quests" class="quick-btn">üìú Q</button>
  <button id="btn-skills" class="quick-btn">‚ö° K</button>
  <button id="btn-map" class="quick-btn">üó∫Ô∏è M</button>
</div>

<style>
/* Panel Styles */
.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: rgba(10, 15, 35, 0.95);
  border-bottom: 1px solid rgba(130, 180, 255, 0.4);
  font-weight: 600;
  font-size: 16px;
}

.panel-header button {
  background: rgba(255, 80, 80, 0.8);
  border: none;
  color: white;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 20px;
  line-height: 24px;
}

.panel-content {
  padding: 16px;
  max-height: 500px;
  overflow-y: auto;
}

/* Inventory Panel */
#inventory-panel {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 500px;
  max-width: 90%;
  background: rgba(5, 5, 15, 0.95);
  border-radius: 10px;
  border: 1px solid rgba(130, 180, 255, 0.6);
  box-shadow: 0 0 30px rgba(0, 0, 0, 0.9);
  z-index: 100;
}

#equipped-slots {
  display: flex;
  gap: 12px;
  margin-bottom: 16px;
  padding-bottom: 16px;
  border-bottom: 1px solid rgba(130, 180, 255, 0.3);
}

.equip-slot {
  flex: 1;
  text-align: center;
}

.slot-label {
  font-size: 11px;
  color: #9db8ff;
  margin-bottom: 4px;
  text-transform: uppercase;
}

.slot-item {
  background: rgba(20, 30, 60, 0.9);
  border: 2px solid rgba(130, 180, 255, 0.5);
  border-radius: 8px;
  padding: 12px 8px;
  min-height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: #cfd8ff;
}

#inventory-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 8px;
}

.inventory-slot {
  aspect-ratio: 1;
  background: rgba(20, 30, 60, 0.8);
  border: 2px solid rgba(130, 180, 255, 0.4);
  border-radius: 6px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 10px;
  padding: 4px;
  transition: all 0.2s;
}

.inventory-slot:hover {
  border-color: #ffe164;
  transform: scale(1.05);
}

.inventory-slot.empty {
  opacity: 0.3;
}

/* Quest Panel */
#quest-panel {
  position: fixed;
  right: 20px;
  top: 80px;
  width: 350px;
  background: rgba(5, 5, 15, 0.95);
  border-radius: 10px;
  border: 1px solid rgba(130, 180, 255, 0.6);
  box-shadow: 0 0 30px rgba(0, 0, 0, 0.9);
  z-index: 100;
}

.quest-item {
  background: rgba(20, 30, 60, 0.9);
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 10px;
  border-left: 3px solid #ffe164;
}

.quest-title {
  font-weight: 600;
  color: #ffe164;
  margin-bottom: 4px;
}

.quest-desc {
  font-size: 12px;
  color: #cfd8ff;
  margin-bottom: 6px;
}

.quest-progress {
  font-size: 11px;
  color: #9db8ff;
}

.quest-reward {
  font-size: 11px;
  color: #7dff7d;
  margin-top: 6px;
}

.quest-btn {
  margin-top: 8px;
  padding: 6px 12px;
  background: linear-gradient(135deg, #4a7bff, #7a4aff);
  border: none;
  border-radius: 4px;
  color: white;
  cursor: pointer;
  font-size: 11px;
}

/* Skill Panel */
#skill-panel {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 600px;
  max-width: 90%;
  background: rgba(5, 5, 15, 0.95);
  border-radius: 10px;
  border: 1px solid rgba(130, 180, 255, 0.6);
  box-shadow: 0 0 30px rgba(0, 0, 0, 0.9);
  z-index: 100;
}

#skill-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}

.skill-node {
  background: rgba(20, 30, 60, 0.9);
  border: 2px solid rgba(130, 180, 255, 0.4);
  border-radius: 8px;
  padding: 12px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
}

.skill-node:hover:not(.skill-locked) {
  border-color: #ffe164;
  transform: scale(1.05);
}

.skill-node.skill-unlocked {
  border-color: #7dff7d;
  background: rgba(40, 60, 40, 0.9);
}

.skill-node.skill-locked {
  opacity: 0.5;
  cursor: not-allowed;
}

.skill-icon {
  font-size: 32px;
  margin-bottom: 6px;
}

.skill-name {
  font-weight: 600;
  font-size: 13px;
  color: #e2e8ff;
  margin-bottom: 4px;
}

.skill-cost {
  font-size: 11px;
  color: #ffe164;
}

/* Enhanced Minimap */
#minimap-enhanced {
  position: fixed;
  right: 12px;
  top: 12px;
  z-index: 11;
  background: rgba(5, 5, 15, 0.9);
  border-radius: 10px;
  border: 1px solid rgba(130, 180, 255, 0.4);
  padding: 8px;
}

#minimap-canvas {
  display: block;
  border-radius: 999px;
  border: 2px solid rgba(130, 180, 255, 0.8);
}

#minimap-info {
  margin-top: 8px;
  font-size: 11px;
  text-align: center;
  color: #cfd8ff;
}

#zone-name {
  font-weight: 600;
  margin-bottom: 2px;
}

/* Quick Menu */
#quick-menu {
  position: fixed;
  top: 50%;
  right: 12px;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 15;
}

.quick-btn {
  width: 50px;
  height: 50px;
  background: rgba(10, 15, 35, 0.95);
  border: 2px solid rgba(130, 180, 255, 0.6);
  border-radius: 8px;
  color: white;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.quick-btn:hover {
  border-color: #ffe164;
  transform: scale(1.1);
}

/* Loot Pickup Notification */
#loot-notification {
  position: fixed;
  bottom: 100px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(10, 15, 35, 0.95);
  border: 2px solid #ffe164;
  border-radius: 8px;
  padding: 12px 20px;
  font-size: 14px;
  color: #ffe164;
  z-index: 200;
  animation: slideUp 0.3s, fadeOut 0.3s 2.7s;
  pointer-events: none;
}

@keyframes slideUp {
  from { bottom: 80px; opacity: 0; }
  to { bottom: 100px; opacity: 1; }
}

@keyframes fadeOut {
  to { opacity: 0; }
}

/* Mobile Adjustments */
@media (max-width: 768px) {
  #inventory-panel, #skill-panel {
    width: 95%;
  }
  
  #quest-panel {
    right: 10px;
    width: calc(100% - 20px);
  }
  
  #inventory-grid {
    grid-template-columns: repeat(4, 1fr);
  }
  
  #quick-menu {
    flex-direction: row;
    top: auto;
    bottom: 150px;
    right: 50%;
    transform: translateX(50%);
  }
}
</style>

<script>
// ============================================================
// ENHANCED UI HANDLERS
// ============================================================

(function() {
  // Toggle panels
  document.getElementById('btn-inventory')?.addEventListener('click', () => {
    const panel = document.getElementById('inventory-panel');
    if (panel) panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    updateInventoryUI();
  });

  document.getElementById('btn-quests')?.addEventListener('click', () => {
    const panel = document.getElementById('quest-panel');
    if (panel) panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    updateQuestUI();
  });

  document.getElementById('btn-skills')?.addEventListener('click', () => {
    const panel = document.getElementById('skill-panel');
    if (panel) panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    updateSkillUI();
  });

  // Close buttons
  document.getElementById('inventory-close')?.addEventListener('click', () => {
    document.getElementById('inventory-panel').style.display = 'none';
  });

  document.getElementById('quest-close')?.addEventListener('click', () => {
    document.getElementById('quest-panel').style.display = 'none';
  });

  document.getElementById('skill-close')?.addEventListener('click', () => {
    document.getElementById('skill-panel').style.display = 'none';
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if (e.key === 'i' || e.key === 'I') {
      document.getElementById('btn-inventory')?.click();
    } else if (e.key === 'q' || e.key === 'Q') {
      document.getElementById('btn-quests')?.click();
    } else if (e.key === 'k' || e.key === 'K') {
      document.getElementById('btn-skills')?.click();
    }
  });

  // Update inventory UI
  window.updateInventoryUI = function() {
    if (!window.GameSystems?.inventory) return;
    
    const inv = window.GameSystems.inventory;
    document.getElementById('inventory-gold').textContent = `Gold: ${inv.gold}`;
    
    // Update equipped items
    for (const slot in inv.equipped) {
      const item = inv.equipped[slot];
      const el = document.getElementById(`equipped-${slot}`);
      if (el) {
        el.textContent = item ? item.name || item.type : 'Empty';
      }
    }
    
    // Update inventory grid
    const grid = document.getElementById('inventory-grid');
    if (grid) {
      grid.innerHTML = '';
      for (let i = 0; i < inv.maxSlots; i++) {
        const slot = document.createElement('div');
        slot.className = 'inventory-slot';
        const item = inv.items[i];
        
        if (item) {
          slot.textContent = item.name || item.type;
          slot.onclick = () => equipItem(i);
        } else {
          slot.classList.add('empty');
          slot.textContent = '';
        }
        
        grid.appendChild(slot);
      }
    }
  };

  // Update quest UI
  window.updateQuestUI = function() {
    if (!window.GameSystems?.quests) return;
    
    const quests = window.GameSystems.quests;
    const activeEl = document.getElementById('active-quests');
    const availableEl = document.getElementById('available-quests');
    
    if (activeEl) {
      activeEl.innerHTML = '<h3 style="margin-bottom: 10px; color: #ffe164;">Active Quests</h3>';
      quests.activeQuests.forEach(quest => {
        const div = document.createElement('div');
        div.className = 'quest-item';
        div.innerHTML = `
          <div class="quest-title">${quest.name}</div>
          <div class="quest-desc">${quest.description}</div>
          <div class="quest-progress">Progress: ${quest.progress}/${quest.required}</div>
          <div class="quest-reward">Reward: ${quest.rewards.gold} gold, ${quest.rewards.xp} XP</div>
          ${quest.progress >= quest.required ? 
            `<button class="quest-btn" onclick="completeQuest('${quest.id}')">Complete</button>` : ''}
        `;
        activeEl.appendChild(div);
      });
    }
    
    if (availableEl) {
      availableEl.innerHTML = '<h3 style="margin: 10px 0; color: #9db8ff;">Available Quests</h3>';
      quests.questTemplates.forEach(quest => {
        if (!quests.activeQuests.find(q => q.id === quest.id) && 
            !quests.completedQuests.find(q => q.id === quest.id)) {
          const div = document.createElement('div');
          div.className = 'quest-item';
          div.style.borderLeft = '3px solid #9db8ff';
          div.innerHTML = `
            <div class="quest-title">${quest.name}</div>
            <div class="quest-desc">${quest.description}</div>
            <div class="quest-reward">Reward: ${quest.rewards.gold} gold, ${quest.rewards.xp} XP</div>
            <button class="quest-btn" onclick="acceptQuest('${quest.id}')">Accept</button>
          `;
          availableEl.appendChild(div);
        }
      });
    }
  };

  // Update skill UI
  window.updateSkillUI = function() {
    if (!window.GameSystems?.skillTree) return;
    
    const tree = window.GameSystems.skillTree;
    document.getElementById('skill-points').textContent = `Points: ${tree.skillPoints}`;
    
    const grid = document.getElementById('skill-grid');
    if (grid) {
      grid.innerHTML = '';
      tree.skills.forEach((skill, id) => {
        const node = document.createElement('div');
        node.className = 'skill-node';
        
        if (tree.unlockedSkills.has(id)) {
          node.classList.add('skill-unlocked');
        } else if (!tree.canUnlock(id)) {
          node.classList.add('skill-locked');
        }
        
        const icons = { 1: '‚öîÔ∏è', 2: 'üî•', 3: '‚ùÑÔ∏è', 4: '‚ö°', 5: '‚òÑÔ∏è', 6: 'üíö', 7: 'üõ°Ô∏è' };
        
        node.innerHTML = `
          <div class="skill-icon">${icons[id] || '‚ú®'}</div>
          <div class="skill-name">${skill.name}</div>
          <div class="skill-cost">Cost: ${skill.cost || 1} SP</div>
        `;
        
        if (!tree.unlockedSkills.has(id)) {
          node.onclick = () => unlockSkill(id);
        }
        
        grid.appendChild(node);
      });
    }
  };

  // Helper functions
  window.equipItem = function(index) {
    if (!window.GameSystems?.inventory) return;
    const oldItem = window.GameSystems.inventory.equipItem(index);
    if (oldItem) {
      window.GameSystems.inventory.addItem(oldItem);
    }
    updateInventoryUI();
    window.GameSystems.sound?.play('loot');
  };

  window.acceptQuest = function(questId) {
    if (!window.GameSystems?.quests) return;
    window.GameSystems.quests.acceptQuest(questId);
    updateQuestUI();
    window.GameSystems.sound?.play('quest');
    showNotification('Quest accepted!');
  };

  window.completeQuest = function(questId) {
    if (!window.GameSystems?.quests || !window.GameSystems?.inventory) return;
    const rewards = window.GameSystems.quests.completeQuest(questId);
    if (rewards) {
      window.GameSystems.inventory.gold += rewards.gold;
      // Award XP to player
      updateQuestUI();
      window.GameSystems.sound?.play('quest');
      showNotification(`Quest complete! +${rewards.gold} gold, +${rewards.xp} XP`);
    }
  };

  window.unlockSkill = function(skillId) {
    if (!window.GameSystems?.skillTree) return;
    if (window.GameSystems.skillTree.unlockSkill(skillId)) {
      updateSkillUI();
      window.GameSystems.sound?.play('levelup');
      showNotification('Skill unlocked!');
    }
  };

  window.showNotification = function(text) {
    let notif = document.getElementById('loot-notification');
    if (!notif) {
      notif = document.createElement('div');
      notif.id = 'loot-notification';
      document.body.appendChild(notif);
    }
    notif.textContent = text;
    notif.style.display = 'block';
    setTimeout(() => {
      notif.style.display = 'none';
    }, 3000);
  };

  // Update minimap
  window.updateMinimap = function(playerPos, enemies) {
    const canvas = document.getElementById('minimap-canvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const size = 180;
    const scale = 2;
    
    ctx.fillStyle = 'rgba(10, 20, 30, 0.9)';
    ctx.fillRect(0, 0, size, size);
    
    // Draw enemies
    enemies.forEach(enemy => {
      const relX = (enemy.position.x - playerPos.x) * scale + size / 2;
      const relZ = (enemy.position.z - playerPos.z) * scale + size / 2;
      
      if (relX >= 0 && relX <= size && relZ >= 0 && relZ <= size) {
        ctx.fillStyle = enemy.isBoss ? '#ff00ff' : '#ff4444';
        ctx.beginPath();
        ctx.arc(relX, relZ, enemy.isBoss ? 6 : 3, 0, Math.PI * 2);
        ctx.fill();
      }
    });
    
    // Draw player
    ctx.fillStyle = '#ffe164';
    ctx.beginPath();
    ctx.arc(size / 2, size / 2, 4, 0, Math.PI * 2);
    ctx.fill();
    
    // Update enemy count
    const enemyCount = document.getElementById('enemy-count');
    if (enemyCount) {
      const alive = enemies.filter(e => e.stats.hp > 0).length;
      enemyCount.textContent = `Enemies: ${alive}`;
    }
  };

  console.log('[UI] Enhanced UI handlers loaded');
})();
</script>
